const navLokacije = [
  {
    name: 'Насловнa',
    link: 'index.html'
  },
  {
    name: 'Надлежности',
    link: 'nadleznosti.html'
  },
  {
    name: 'Запослени',
    link: 'zaposleni.html'
  },
  {
    name: 'Саветници спољни сарадници',
    link: 'savetnici-spoljni-saradnici.html'
  },
  {
    name: 'Издвајамо',
    link: 'izdvajamo.html'
  },
  {
    name: 'Сва питања и одговори',
    link: 'sva-pitanja-i-odgovori.html'
  },
  {
    name: 'Сва обавештења',
    link: 'sva-obavestenja.html'
  },
  {
    name: 'Ариље - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Arilje.html'
  },
  {
    name: 'Ариље - Основне школе',
    link: 'Ustanove/Osnovne-skole/Arilje.html'
  },
  {
    name: 'Ариље - Средње школе',
    link: 'Ustanove/Srednje-skole/Arilje.html'
  },
  {
    name: 'Ариље - Општинa',
    link: 'Ustanove/Opstine/Arilje.html'
  },
  {
    name: 'Бајина Башта - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Bajina-Basta.html'
  },
  {
    name: 'Бајина Башта - Основне школе',
    link: 'Ustanove/Osnovne-skole/Bajina-Basta.html'
  },
  {
    name: 'Бајина Башта - Средње школе',
    link: 'Ustanove/Srednje-skole/Bajina-Basta.html'
  },
  {
    name: 'Бајина Башта - Општинa',
    link: 'Ustanove/Opstine/Bajina-Basta.html'
  },
  {
    name: 'Косјерић - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Kosjeric.html'
  },
  {
    name: 'Косјерић - Основне школе',
    link: 'Ustanove/Osnovne-skole/Kosjeric.html'
  },
  {
    name: 'Косјерић - Средње школе',
    link: 'Ustanove/Srednje-skole/Kosjeric.html'
  },
  {
    name: 'Косјерић - Општинa',
    link: 'Ustanove/Opstine/Kosjeric.html'
  },
  {
    name: 'Нова Варош - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Nova-Varos.html'
  },
  {
    name: 'Нова Варош - Основне школе',
    link: 'Ustanove/Osnovne-skole/Nova-Varos.html'
  },
  {
    name: 'Нова Варош - Средње школе',
    link: 'Ustanove/Srednje-skole/Nova-Varos.html'
  },
  {
    name: 'Нова Варош - Општинa',
    link: 'Ustanove/Opstine/Nova-Varos.html'
  },
  {
    name: 'Пожега - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Pozega.html'
  },
  {
    name: 'Пожега - Основне школе',
    link: 'Ustanove/Osnovne-skole/Pozega.html'
  },
  {
    name: 'Пожега - Средње школе',
    link: 'Ustanove/Srednje-skole/Pozega.html'
  },
  {
    name: 'Пожега - Општинa',
    link: 'Ustanove/Opstine/Pozega.html'
  },
  {
    name: 'Пољопривредна школа са домом ученика "Љубо Мићић" Пожега',
    link: 'Ustanove/Domovi-ucenika/Ljubo-Micic-Pozega.html'
  },
  {
    name: 'Прибој - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Priboj.html'
  },
  {
    name: 'Прибој - Основне школе',
    link: 'Ustanove/Osnovne-skole/Priboj.html'
  },
  {
    name: 'Прибој - Средње школе',
    link: 'Ustanove/Srednje-skole/Priboj.html'
  },
  {
    name: 'Прибој - Општинa',
    link: 'Ustanove/Opstine/Priboj.html'
  },
  {
    name: 'Пријепоље - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Prijepolje.html'
  },
  {
    name: 'Пријепоље - Основне школе',
    link: 'Ustanove/Osnovne-skole/Prijepolje.html'
  },
  {
    name: 'Пријепоље - Средње школе',
    link: 'Ustanove/Srednje-skole/Prijepolje.html'
  },
  {
    name: 'Пријепоље - Општинa',
    link: 'Ustanove/Opstine/Prijepolje.html'
  },
  {
    name: 'Сјеница - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Sjenica.html'
  },
  {
    name: 'Сјеница - Основне школе',
    link: 'Ustanove/Osnovne-skole/Sjenica.html'
  },
  {
    name: 'Сјеница - Средње школе',
    link: 'Ustanove/Srednje-skole/Sjenica.html'
  },
  {
    name: 'Сјеница - Општинa',
    link: 'Ustanove/Opstine/Sjenica.html'
  },
  {
    name: 'Ужице - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Uzice.html'
  },
  {
    name: 'Ужице - Основне школе',
    link: 'Ustanove/Osnovne-skole/Uzice.html'
  },
  {
    name: 'Ужице - Средње школе',
    link: 'Ustanove/Srednje-skole/Uzice.html'
  },
  {
    name: 'Ужице - Општинa',
    link: 'Ustanove/Opstine/Uzice.html'
  },
  {
    name: 'Дом ученика средњих школа Ужице',
    link: 'Ustanove/Domovi-ucenika/Dom-ucenika-srednjih-skola-Uzice.html'
  },
  {
    name: 'Чајетина - Предшколске установе',
    link: 'Ustanove/Predskolske-ustanove/Cajetina.html'
  },
  {
    name: 'Чајетина - Основне школе',
    link: 'Ustanove/Osnovne-skole/Cajetina.html'
  },
  {
    name: 'Чајетина - Средње школе',
    link: 'Ustanove/Srednje-skole/Cajetina.html'
  },
  {
    name: 'Чајетина - Општинa',
    link: 'Ustanove/Opstine/Cajetina.html'
  },
  {
    name: 'Број деце и ученика у установама',
    link: 'Ustanove/Broj-dece-i-ucenika-u-ustanovama.html'
  },
  {
    name: 'Инклузивно образовање - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Inkluzivno-obrazovanje/Zakonska-regulativa.html'
  },
  {
    name: 'Инклузивно образовање - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Inkluzivno-obrazovanje/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Инклузивно образовање - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Inkluzivno-obrazovanje/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Инклузивно образовање - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Inkluzivno-obrazovanje/Pitanja-i-odgovori.html'
  },
  {
    name: 'Превенција насиља - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Prevencija-nasilja/Zakonska-regulativa.html'
  },
  {
    name: 'Превенција насиља - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Prevencija-nasilja/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Превенција насиља - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Prevencija-nasilja/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Превенција насиља - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Prevencija-nasilja/Pitanja-i-odgovori.html'
  },
  {
    name: 'Развојно планирање - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Razvojno-planiranje/Zakonska-regulativa.html'
  },
  {
    name: 'Развојно планирање - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Razvojno-planiranje/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Развојно планирање - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Razvojno-planiranje/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Развојно планирање - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Razvojno-planiranje/Pitanja-i-odgovori.html'
  },
  {
    name: 'Стандарди у образовању - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Standardi-u-obrazovanju/Zakonska-regulativa.html'
  },
  {
    name: 'Стандарди у образовању - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Standardi-u-obrazovanju/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Стандарди у образовању - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Standardi-u-obrazovanju/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Стандарди у образовању - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Standardi-u-obrazovanju/Pitanja-i-odgovori.html'
  },
  {
    name: 'Самовредновање и вредновање установа - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Samovrednovanje-i-vrednovanje-ustanova/Zakonska-regulativa.html'
  },
  {
    name: 'Самовредновање и вредновање установа - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Samovrednovanje-i-vrednovanje-ustanova/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Самовредновање и вредновање установа - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Samovrednovanje-i-vrednovanje-ustanova/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Самовредновање и вредновање установа - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Samovrednovanje-i-vrednovanje-ustanova/Pitanja-i-odgovori.html'
  },
  {
    name: 'Стручно-педагошки надзор - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Strucno-predagoski-nadzor/Zakonska-regulativa.html'
  },
  {
    name: 'Стручно-педагошки надзор - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Strucno-predagoski-nadzor/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Стручно-педагошки надзор - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Strucno-predagoski-nadzor/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Стручно-педагошки надзор - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Strucno-predagoski-nadzor/Pitanja-i-odgovori.html'
  },
  {
    name: 'Стручно усавршавање и стицање звања - Законска регулатива',
    link: 'Teme-koje-istrazujemo/Strucno-usavrsavanje-i-sticanje-zvanja/Zakonska-regulativa.html'
  },
  {
    name: 'Стручно усавршавање и стицање звања - Додатни извори знања',
    link: 'Teme-koje-istrazujemo/Strucno-usavrsavanje-i-sticanje-zvanja/Dodatni-izvori-znanja.html'
  },
  {
    name: 'Стручно усавршавање и стицање звања - Наша искуства и примери добре праксе',
    link: 'Teme-koje-istrazujemo/Strucno-usavrsavanje-i-sticanje-zvanja/Nasa-iskustva-i-primeri-dobre-prakse.html'
  },
  {
    name: 'Стручно усавршавање и стицање звања - Питања и одговори',
    link: 'Teme-koje-istrazujemo/Strucno-usavrsavanje-i-sticanje-zvanja/Pitanja-i-odgovori.html'
  },
  {
    name: 'Календар образовно-васпитног рада за основне школе',
    link: 'Aktuelno/Kalendar-obrazovno-vaspitnog-rada/Za-osnovne-skole.html'
  },
  {
    name: 'Календар образовно-васпитног рада за средње школе',
    link: 'Aktuelno/Kalendar-obrazovno-vaspitnog-rada/Za-srednje-skole.html'
  },
  {
    name: 'Упис у предшколску установу',
    link: 'Aktuelno/Upis-u-skolu/Upis-u-predskolsku-ustanovu.html'
  },
  {
    name: 'Упис у основну школу',
    link: 'Aktuelno/Upis-u-skolu/Upis-u-osnovnu-skolu.html'
  },
  {
    name: 'Упис у средњу школу',
    link: 'Aktuelno/Upis-u-skolu/Upis-u-srednju-skolu.html'
  },
  {
    name: 'Упис ученика из иностранства',
    link: 'Aktuelno/Upis-u-skolu/Upis-ucenika-iz-inostranstva.html'
  },
  {
    name: 'Пробни завршни испит',
    link: 'Aktuelno/Zavrsni-ispit/Probni-zavrsni-ispit.html'
  },
  {
    name: 'Завршни испит',
    link: 'Aktuelno/Zavrsni-ispit/Zavrsni-ispit.html'
  },
  {
    name: 'Пробна државна матура',
    link: 'Aktuelno/Drzavna-matura/Probna-drzavna-matura.html'
  },
  {
    name: 'Државна матура',
    link: 'Aktuelno/Drzavna-matura/Drzavna-matura.html'
  },
  {
    name: 'Национална и међународна истраживања',
    link: 'nacionalna-istazivanja.html'
  },
  {
    name: 'Слободна радна места',
    link: 'Zaposljavanje-u-prosveti/Slobodna-radna-mesta.html'
  },
  {
    name: 'Технолошки вишкови и запослени са непуном нормом',
    link: 'Zaposljavanje-u-prosveti/Tehnoloski-viskovi-i-zaposleni-sa-nepunom-normom.html'
  },
  {
    name: 'Нострификација докумената',
    link: 'Zaposljavanje-u-prosveti/Nostrifikacija-dokumenata.html'
  },
  {
    name: 'Прописи у образовању',
    link: 'propisi-u-obrazovanju.html'
  },
  {
    name: 'Контакт',
    link: 'kontakt.html'
  }
];

let navLokacijeFull = [];

navLokacije.forEach(element => {
  navLokacijeFull.push(new Lokacija(element.name, element.link));
});
// console.log(navLokacijeFull);

// ============================================================ STARI JSON GET XML HTTP REQUEST
// const getJSON = (resource) => {

//   return new Promise((resolve, reject) => {
//     const request = new XMLHttpRequest();

//     request.addEventListener('readystatechange', () => {
  
//       if(request.readyState === 4 && request.status === 200){
//         const data = JSON.parse(request.responseText);
//         resolve(data);
//       } else if (request.readyState === 4){
//         reject('error-request-status: '+ request + request.status);
//       }s
  
//     });
    
//     request.open('GET', resource);
//     request.send();
//   });

// };
// =======================================================================


const getJSON = async (resource) => {
  let response = await fetch(resource);

  if(response.status !== 200){
    throw new Error('cannot fetch the data');
  }

  let data = await response.json();
  return data;
};


const currentPathName = window.location.pathname;
const currentPathNameArray = currentPathName.substring(1).split('/');
// console.log(currentPathNameArray);

//----------------------PUTANJA KA JSON FAJLOVIMA-----------------------------
const izdvajamoLink = 'https://miki-peric.github.io/JSONtest/izdvajamo.json';
const obavestenjaLink = 'https://miki-peric.github.io/JSONtest/obavestenja.json';
const pitanjaLink = 'https://miki-peric.github.io/JSONtest/pitanja.json';


let izdvajamo, obavestenja, pitanja;

if(currentPathName.includes('index') || currentPathName === '/pilot-novi/') {
  getJSON(izdvajamoLink).then(data => {
    izdvajamo = data;
    return getJSON(obavestenjaLink);
  }).then(data => {
    obavestenja = data;
    return getJSON(pitanjaLink);
  }).then(data => {

    pitanja = data;

    if (document.readyState === "interactive" || document.readyState === "complete") {
      showPrefooter(pitanja, obavestenja);
      showMainSlider(izdvajamo);
      showOtherSlider(obavestenja);
    } else {
      document.addEventListener("DOMContentLoaded", function() {
        showPrefooter(pitanja, obavestenja);
        showMainSlider(izdvajamo);
        showOtherSlider(obavestenja);
      });
    }

  }).catch(err => {
    console.log('promise rejected:', err);
  });

} else if(currentPathName.includes('sva-obavestenja')) {
  //OK
  showJSONbyId('id', obavestenjaLink, 'obavestenja');

} else if(currentPathName.includes('sva-pitanja-i-odgovori')) {
  //OK
  showJSONbyId('id', pitanjaLink, 'pitanje');

} else if(currentPathName.includes('Pitanja-i-odgovori')) {
  //OK
  showJSONbyId('grupa', pitanjaLink, 'pitanje', currentPathNameArray[currentPathNameArray.length - 2]);

} else if(currentPathName.includes('izdvajamo')) {
  //OK
  showJSONbyId('id', izdvajamoLink, 'izdvajamo');

} else if(currentPathName.includes('Nasa-iskustva-i-primeri-dobre-prakse')) {
  //OK
  showJSONbyId('grupa', izdvajamoLink, 'izdvajamo', currentPathNameArray[currentPathNameArray.length - 2]);

} else if(currentPathName.includes('searchResults')) {
  getJSON(izdvajamoLink).then(data => {
    izdvajamo = data;

    izdvajamo.forEach(element => {
      navLokacijeFull.push(new Lokacija(element.naslov, 'izdvajamo.html?id=' + element.id));
    });
    // console.log(navLokacijeFull);

    return getJSON(obavestenjaLink);
  }).then(data => {
    obavestenja = data;

    obavestenja.forEach(element => {
      navLokacijeFull.push(new Lokacija(element.naslov, 'sva-obavestenja.html?id=' + element.id));
    });
    // console.log(navLokacijeFull);

    return getJSON(pitanjaLink);
  }).then(data => {
    //ovo bi trebalo bit OK
    pitanja = data;

    pitanja.forEach(element => {
      navLokacijeFull.push(new Lokacija(element.naslov, 'sva-pitanja-i-odgovori.html?id=' + element.id));
    });
    // console.log(navLokacijeFull);
    searchLogic();

  }).catch(err => {
    console.log('promise rejected:', err);
  });
}


function onePost(obj, type) {

  const jsonContainer = document.querySelector('.jsonContainer');

  //div.objavaJSON
  const post = document.createElement('div');
  post.classList.add('objavaJSON' + type);

  //div.naslovJSON
  const naslov = document.createElement('div');
  naslov.classList.add('naslovJSON' + type);
  const h1 = document.createElement('h1');
  h1.textContent = obj.naslov;
  naslov.appendChild(h1);
  post.appendChild(naslov);

  if(obj.slika) {
    //div.slikaJSON
    const slika = document.createElement('div');
    slika.classList.add('slikaJSON' + type);
    const img = document.createElement('img');
    img.setAttribute('src', linkPrefix() + 'SLIKE/' + obj.slika);
    slika.appendChild(img);
    post.appendChild(slika);
  }

  //div.tekstJSON
  const tekst = document.createElement('div');
  tekst.classList.add('tekstJSON' + type);
  obj.tekst.forEach(t => {
    const para = document.createElement('p');
    para.textContent = t;
    tekst.appendChild(para);
  });

  //div.datumJSON
  const datum = document.createElement('div');
  datum.classList.add('datumJSON' + type);
  const para = document.createElement('p');
  para.textContent = obj.datum;
  datum.appendChild(para);
  tekst.appendChild(datum);

  post.appendChild(tekst);
  jsonContainer.appendChild(post);

}

function searchOneResult(element) {
  const jsonContainer = document.querySelector('.jsonContainer');

  //div.searchResult
  const post = document.createElement('div');
  post.classList.add('searchResult');

  //searchLink - <a><h2>
  const searchLink = document.createElement('a');
  const h2 = document.createElement('h2');
  h2.textContent = element.name[0];
  searchLink.appendChild(h2);
  searchLink.setAttribute('href', element.link);

  post.appendChild(searchLink);

  jsonContainer.appendChild(post);
}

function queryParameters(parameter) {
  const urlParams = new URLSearchParams(window.location.search);
  const par = urlParams.get(parameter);

  if(!par) {
    return undefined;
  }
  return par;
}


function linkPrefix() {
  const currentPathName = window.location.pathname;
  const currentPathNameArray = currentPathName.substring(1).split('/');

  let pom = '';

  for(let i = 1; i < currentPathNameArray.length - 1; i++) {
    pom += '../'
  }

  return pom;
}


function showJSONbyId(key, jsonFile, type, query = queryParameters(key)) {
  // getJSON(linkPrefix() + 'JSON/' + jsonFile).then(data => {
  getJSON(jsonFile).then(data => {
    data = data.reverse();

    const res = data.filter( d => d[key] == query);

    if (document.readyState === "interactive" || document.readyState === "complete") {
      if(res.length) {
        res.forEach(r => onePost(r, '-' + type))
      } else {
        data.forEach(obj => onePost(obj, '-' + type));
      }
    } else {
      document.addEventListener("DOMContentLoaded", function() {
        if(res.length) {
          res.forEach(r => onePost(r, '-' + type))
        } else {
          data.forEach(obj => onePost(obj, '-' + type));
        }
      });
    }

  }).catch(err => {
    console.log('promise rejected:', err);
  });

}

function showPrefooter(pitanja, obavestenja) {
  const pitanjeh2 = document.querySelector("body > main > div:nth-child(3) > div.pre-footer > div:nth-child(2) > div.pfbMain > h2");
  const pitanjeP = document.querySelector("body > main > div:nth-child(3) > div.pre-footer > div:nth-child(2) > div.pfbMain > p");

  const obavestenjeh2 = document.querySelector("body > main > div:nth-child(3) > div.pre-footer > div:nth-child(3) > div.pfbMain > h2");
  const obavestenjeP = document.querySelector("body > main > div:nth-child(3) > div.pre-footer > div:nth-child(3) > div.pfbMain > p");


  insertPrefooter(pitanja[getRandomInt(pitanja.length)], pitanjeh2, pitanjeP, 'sva-pitanja-i-odgovori.html');
  insertPrefooter(obavestenja[obavestenja.length - 1], obavestenjeh2, obavestenjeP, 'sva-obavestenja.html');
}

function insertPrefooter(obj, naslov, para, link) {
  const fullText = obj.tekst.join(' ');
  console.log(fullText);
  const words = fullText.split(' ');
  const first40Words = words.slice(0, 40);
  const first40WordsStr = first40Words.join(' ');

  naslov.innerHTML = obj.naslov;
  para.innerHTML = first40WordsStr + '...<br><br>' + `<a href="${link}?id=${obj.id}">Прочитајте више...</a>`;
}

function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}

function prevodjenje(text) {
  const cirilica = {
    'а': 'a',
    'б': 'b',
    'в': 'v',
    'г': 'g',
    'д': 'd',
    'ђ': 'dj',
    'е': 'e',
    'ж': 'z',
    'з': 'z',
    'и': 'i',
    'ј': 'j',
    'к': 'k',
    'л': 'l',
    'љ': 'lj',
    'м': 'm',
    'н': 'n',
    'њ': 'nj',
    'о': 'o',
    'п': 'p',
    'р': 'r',
    'с': 's',
    'т': 't',
    'ћ': 'c',
    'у': 'u',
    'ф': 'f',
    'х': 'h',
    'ц': 'c',
    'ч': 'c',
    'џ': 'dz',
    'ш': 's',
    'đ': 'dj',
    'ž': 'z',
    'ć': 'c',
    'č': 'c',
    'ž': 'z',
    'š': 's',
  };
  
  let latinicaText = '';
  for (let i = 0; i < text.length; i++) {
    const char = text[i];
    latinicaText += cirilica[char.toLowerCase()] || char.toLowerCase();
  }
  return latinicaText;
}


function Lokacija(name, link) {
  this.name = [name];
  this.name.push(prevodjenje(name));
  this.link = link;
  this.score = 0;
}

function searchLogic() {
  const searchWord = document.querySelector('#search-word');
  let fullword = prevodjenje(queryParameters('key'));

  const wordArr = fullword.split(' ');
  
  let results = [];
  wordArr.forEach(word => {
    if(word.length >= 3) {
      word = word.substring(0, word.length - 1);
      console.log(word);
    }
    const oneWordResults = navLokacijeFull.filter(element => element.name[1].includes(word));
    results = results.concat(oneWordResults);
  });
  
  duplicates(results);
  results.forEach(element => {
    element.score = similarity(element.name[1], fullword);
  });
  results.sort((a, b) => b.score - a.score);
  console.log(results);
    if(queryParameters('key')) {
      searchWord.innerHTML = queryParameters('key') + `  (${results.length} резултата)`;

      if (document.readyState === "interactive" || document.readyState === "complete") {
        results.forEach(element => {
          searchOneResult(element);
        });
      } else {
        document.addEventListener("DOMContentLoaded", function() {
          results.forEach(element => {
            searchOneResult(element);
          });
        });
      }
    } else {
      searchWord.innerHTML =  'непознат унос  (0 резултата)';
    }
}

function similarity(s1, s2) {
  let longer = s1;
  let shorter = s2;
  if (s1.length < s2.length) {
    longer = s2;
    shorter = s1;
  }
  let longerLength = longer.length;
  if (longerLength == 0) {
    return 1.0;
  }
  return (longerLength - editDistance(longer, shorter)) / parseFloat(longerLength);
}

function editDistance(s1, s2) {
  s1 = s1.toLowerCase();
  s2 = s2.toLowerCase();

  let costs = new Array();
  for (let i = 0; i <= s1.length; i++) {
    let lastValue = i;
    for (let j = 0; j <= s2.length; j++) {
      if (i == 0)
        costs[j] = j;
      else {
        if (j > 0) {
          let newValue = costs[j - 1];
          if (s1.charAt(i - 1) != s2.charAt(j - 1))
            newValue = Math.min(Math.min(newValue, lastValue),
              costs[j]) + 1;
          costs[j - 1] = lastValue;
          lastValue = newValue;
        }
      }
    }
    if (i > 0)
      costs[s2.length] = lastValue;
  }
  return costs[s2.length];
}

function duplicates(array) {
  for(let i = 0; i < array.length; ++i) {
    for(let j = i + 1; j < array.length; ++j) {
        if(array[i] === array[j]) {
          array.splice(j--, 1);
        }  
    }
  }
}

function showMainSlider(niz) {
  const slides = document.querySelectorAll('.sliderMain .slideContent');
  const slidesArr = Array.from(slides);

  slidesArr.forEach((slide, index) => {
    const header = slide.querySelector('h1 a');
    header.textContent = niz[niz.length - index - 1].naslov;
    header.href = 'izdvajamo.html?id=' + (niz.length - index);

    const paragraph = slide.querySelector('p');
    let paraText = niz[niz.length - index - 1].tekst[0];

    if(window.innerWidth < 450) {
      paraText = limitParagraph(paraText, 250);
    } else if(window.innerWidth < 768) {
      paraText = limitParagraph(paraText, 400);
    } else if(window.innerWidth < 1024) {
      paraText = limitParagraph(paraText, 600);
    } else if(window.innerWidth < 1280) {
      paraText = limitParagraph(paraText, 350);
    } else {
      paraText = limitParagraph(paraText, 500);
    }
    paragraph.innerHTML = paraText;

    const h3 = slide.querySelector('h3');
    h3.innerHTML = 'Датум објаве: ' + niz[niz.length - index - 1].datum;

    const photo = slide.querySelector('.sliderPhotoPlace');
    const photoLink = niz[niz.length - index - 1].slika;

    if(photoLink) {
      photo.style.backgroundImage = `url('SLIKE/${photoLink}')`;
    } else {
      photo.style.backgroundImage = `url('SLIKE/nullPicture.jpg')`;
    }

  });
}

function limitParagraph(text, limit, dots = 1) {
  let sufix = '...';
  if(!dots) {
    sufix = '';
  }

  if (text.length <= limit) {
    return text + sufix;
  }

  const shortText = text.substring(0, limit);
  const lastSpace = shortText.lastIndexOf(' ');

  if (lastSpace === -1) {
    return shortText + sufix;
  }

  return shortText.substring(0, lastSpace) + sufix;
}

function showOtherSlider(niz) {
  const slide = document.querySelectorAll('.basicSliderCon .b-slide');
  const slideArr = Array.from(slide);

  slideArr.forEach((slide, index) => {
    const date = slide.querySelector('.backgroundDate p a');
    const para = slide.querySelector('.frontText p');
    const link = slide.querySelector('.linkObavestenje a');

    date.textContent = niz[niz.length - 1 - index].datum;
    date.href = 'sva-obavestenja.html?id=' + (niz.length - index);
    link.href = 'sva-obavestenja.html?id=' + (niz.length - index);
    para.innerHTML = limitParagraph(niz[niz.length - 1 - index].naslov, 200, false);
  });
}